<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IoT Dashboard</title>

<!-- Tailwind & Chart.js -->
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  /* full-screen background image, lightly visible */
  body {
    background: url("imagescampus.jpg.jpg") no-repeat center center fixed;
    background-size: contain;
  }
  /* subtle dark overlay for readability */
  body::before {
    content: '';
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(255,255,255,0.4);
    backdrop-filter: blur(2px);
    z-index: -1;
  }

  /* glass effect for chart container */
  .glass-card {
    background: rgba(255,255,255,0.8);
    backdrop-filter: blur(10px);
    box-shadow: 0 0 20px rgba(0,0,0,0.15);
  }

  /* simple fade-in animation */
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to   { opacity: 1; transform: translateY(0); }
  }
  .fade-in { animation: fadeIn 1.2s ease-out forwards; }
</style>
</head>

<body class="min-h-screen flex flex-col">

  <!-- Navbar -->
  <nav class="bg-blue-600/90 p-4 flex justify-between items-center shadow-md">
    <h1 class="text-white text-2xl font-bold tracking-wide">Dashboard</h1>
    <button onclick="logout()"
            class="bg-white/90 text-blue-700 px-4 py-2 rounded-lg font-semibold hover:bg-white transition">
      Logout
    </button>
  </nav>

  <!-- Welcome Section -->
  <div class="p-6 text-center">
    <h2 id="welcome"
        class="text-2xl font-semibold text-blue-900 mb-2 fade-in"></h2>
    <p class="text-gray-700 fade-in"
       style="animation-delay:0.3s; animation-fill-mode:forwards;">
       Live sensor data of our Robot is displayed below.
    </p>
  </div>

  <!-- Chart Container -->
  <div class="max-w-4xl mx-auto glass-card rounded-xl p-6 fade-in"
       style="animation-delay:0.6s; animation-fill-mode:forwards;">
    <canvas id="dataChart" height="120"></canvas>
  </div>

<script>
  // --- Login check ---
  const email = sessionStorage.getItem('userEmail');
  if(!email){
    window.location.href = 'index.html';
  } else {
    document.getElementById('welcome').textContent = `Welcome, ${email}`;
  }

  function logout(){
    sessionStorage.clear();
    window.location.href = 'index.html';
  }

  // --- ThingSpeak data fetch ---
  const channelID = '3081280';        // replace with your channel ID
  const readAPIKey = 'YOUR_READ_API_KEY';     // optional if channel is public
  const field = 1; // Field number to display

  async function fetchData(){
    try {
      const url = `https://api.thingspeak.com/channels/${channelID}/fields/${field}.json?results=20&api_key=${readAPIKey}`;
      const response = await fetch(url);
      const data = await response.json();
      const feeds = data.feeds;

      const labels = feeds.map(f => new Date(f.created_at).toLocaleTimeString());
      const values = feeds.map(f => parseFloat(f[`field${field}`]));

      updateChart(labels, values);
    } catch(err){
      console.error('Error fetching data:', err);
    }
  }

  let chart;
  function updateChart(labels, values){
    if(chart) chart.destroy();
    const ctx = document.getElementById('dataChart').getContext('2d');
    chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: labels,
        datasets: [{
          label: 'Sensor Data',
          data: values,
          borderColor: 'rgba(37,99,235,0.9)',
          backgroundColor: 'rgba(37,99,235,0.25)',
          borderWidth: 2,
          fill: true,
          pointRadius: 3,
          tension: 0.3   // smoother curve
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: { beginAtZero: false },
          x: { ticks: { maxRotation: 90, minRotation: 45 } }
        }
      }
    });
  }

  fetchData();
  setInterval(fetchData, 20000); // refresh every 20 seconds
</script>
</body>
</html>
